<div class="fullscreen-wrapper flexAndColumn h100">
	<div class="fullscreen-header flex5p">
		<h4
			class="font14"
			style="color: #f8f8f8; text-align: left; padding: 5px">

			<span
				class="font13"
				id="fullscreen_title"
				style="font-weight: bold">
				<i class="fa fa-edit"></i>
				제품 및 버전별 작업자
			</span>
		</h4>
		<div
			class="gradient_middle_border"
			style="width: 100%; height: 2px"></div>
		<div class="widget-controls" style="margin:10px">
			<a data-widgster="restore" title="Restore" href="#">
				<span class="glyphicon glyphicon-remove"></span>
			</a>
		</div>
	</div>
	<div  class="fullscreen-body flex1"
				style="padding: 5px;;">
		<div class="col-lg-12 h100 no-padding fullscreen-body-main">
			<section class="widget-tabs h100 flexAndColumn">
				<header style="flex: 0 0 3%;">
					<ul class="nav nav-tabs">
						<li class="chart_tab active">
							<a href="#chart_data" data-toggle="tab">차트 보기</a>
						</li>
						<li class="list_tab">
							<a href="#excel_data" data-toggle="tab">목록 보기</a>
						</li>
<!--						<li class="option_tab" style="float: right !important;">
							<a href="#option_toggle" data-toggle="tab" style="margin-right: 0px">설정</a>
						</li>-->
					</ul>
				</header>
				<div class="body tab-content fs-tab-content" style="flex:1; display: flex; flex-direction: column;">
					<div id="chart_data" class="tab-pane h100 active">
						<div class="flexAndColumn h100">
							<h5 class="tab-header font13" style="color:#f8f8f8; flex:0 0 3%; padding-bottom: 3px; margin-bottom: 3px;">
								<i class="fa fa-bar-chart-o"></i> Chart View
								<div
									class="gradient_middle_border"
									style="width: 100%; height: 1px"></div>
							</h5>
							<div id="modal_chart" style="flex:0 0 97%; overflow: hidden; display: flex">
								<span style="margin: auto">
									※ Notification ※
									<br/>
									전체 데이터 렌더링 영역 입니다.
									<br/>
									이 영역의 화면(차트 등)을 개발 진행 중입니다.
									<br/>
									<br/>
									첫번째 탭은 전체 데이터를 활용한 차트 렌더링 영역입니다.
									<br/>
									두번째 탭은 전체 데이터를 엑셀 형태로 제공하고 있습니다.
								</span>
							</div>
						</div>
					</div>
					<div id="excel_data" class="tab-pane h100">
						<div class="flexAndColumn h100">
							<h5 class="tab-header font13 flexAndRow" style="color:#f8f8f8; flex:0 0 3%; padding-bottom: 3px; align-items: center; margin-bottom: 0px">
								<div class="tab-image-container" style="margin: 5px 3px 5px 0">
									<img src="./img/spreadsheet/spreadsheet-2127832_1920.png" id="side_jira_white_icon" width="40px">
								</div>
								<div class="tab-title-container w100 flexAndColumn">
									<div id="tab-doc-title-bar" style="line-height: 20px; font-size: 15px; margin: 8px 0 8px 8px">List View (Excel)</div>
									<div id="tab-doc-bar" class="flexAndRow btn-group">
										<button type="button" class="btn btn-xs btn-default" style="background: transparent; border:none; margin:0 2px;">파일</button>
										<button type="button" class="btn btn-xs btn-default" style="background: transparent; border:none; margin:0 2px;">수정</button>
										<button type="button" class="btn btn-xs btn-default" style="background: transparent; border:none; margin:0 2px;">보기</button>
										<button type="button" class="btn btn-xs btn-default" style="background: transparent; border:none; margin:0 2px;">삽입</button>
										<button type="button" class="btn btn-xs btn-default" style="background: transparent; border:none; margin:0 2px;">서식</button>
										<button type="button" class="btn btn-xs btn-default" style="background: transparent; border:none; margin:0 2px;">데이터</button>
										<button type="button" class="btn btn-xs btn-default" style="background: transparent; border:none; margin:0 2px;">도구</button>
										<button type="button" class="btn btn-xs btn-default" style="background: transparent; border:none; margin:0 2px;">확장프로그램</button>
										<button type="button" class="btn btn-xs btn-default" style="background: transparent; border:none; margin:0 2px;">도움말</button>
									</div>
								</div>
							</h5>
							<div
								class="gradient_middle_border"
								style="width: 100%; height: 1px"></div>
							<div id="modal_excel" style="flex:0 0 97%; min-height: 30px;"></div>
						</div>
					</div>
			</section>
		</div>
<!--		<div class="col-lg-3 fullscreen-body-option hidden">
			<section class="widget widget-tabs">
				<header>
					<ul class="nav nav-tabs">
						<li class="active">
							<a href="#version_filter" data-toggle="tab">조건 <i class="fa fa-cog"></i></a>
						</li>
					</ul>
				</header>
				<div class="body tab-content">
					<div id="modal_options" class="tab-pane clearfix active">
					</div>
				</div>
			</section>
		</div>-->
	</div>
</div>

<style>
    .wh100 {
        height: 100%;
        width: 100%;
    }
    .w100 { width: 100%;  }
    .h100 {	height: 100%;	}

    .flexAndColumn {
        display: flex;
        flex-direction: column;
    }
    .flexAndRow {
        display: flex;
        flex-direction: row;
    }

    .no-padding { padding: 0; }

    .flex1 { flex: 1;}
    .flex5p  { flex:0 0 5%; }
    .flex10p {	flex:0 0 10%;	}

    .fullscreen-footer {
        background-color: transparent;padding: 5px;text-align: right;border-top: 0px;flex: 0 0 5%;
        display: flex;flex-direction: row-reverse;align-content: center;align-items: flex-end;
    }
</style>
<script>
	function widgsterDocReady() {
		var pluginGroups = [
			[	"./js/common/jspreadsheet/spreadsheet.js",
				"./js/common/jspreadsheet/modalTabFunction.js"
			]
		];

		loadPluginGroupsParallelAndSequential(pluginGroups).then(function() {
			console.log("해당 html 및 js 로드 완료.");

			// excelColumn 세팅 (width ratio)
			var columnList = [
				{ type: "text", title: "제품(서비스) 키", wRatio: 0.1},
				{ type: "text", title: "제품(서비스) 명", wRatio: 0.25},
				{ type: "text", title: "버전 키", 				wRatio: 0.1},
				{ type: "text", title: "버전 명", 				wRatio: 0.15},
				{ type: "text", title: "작업자 키", 			wRatio: 0.3},
				{ type: "text", title: "작업자", 					wRatio: 0.1}
			];

			var mock_data = [
				{
					"id": "22-product",
					"name": "313 SOFT - 요구사항 관리 시스템 - ALM RMS",
					"type": "제품",
					"parent": ""
				},
				{
					"id": "33-version",
					"name": "BaseVersion",
					"type": "버전",
					"parent": ""
				},
				{
					"id": "35-version",
					"name": "1.0.0",
					"type": "버전",
					"parent": ""
				},
				{
					"id": "36-version",
					"name": "1.0.1",
					"type": "버전",
					"parent": ""
				},
				{
					"id": "37-version",
					"name": "24.01",
					"type": "버전",
					"parent": ""
				},
				{
					"id": "46-version",
					"name": "24.02",
					"type": "버전",
					"parent": ""
				},
				{
					"id": "55-version",
					"name": "24.03",
					"type": "버전",
					"parent": ""
				},
				{
					"id": "59-version",
					"name": "24.04",
					"type": "버전",
					"parent": ""
				},
				{
					"id": "61-version",
					"name": "24.05",
					"type": "버전",
					"parent": ""
				},
				{
					"id": "74-version",
					"name": "24.06",
					"type": "버전",
					"parent": ""
				},
				{
					"id": "5f18ccb5ce15e800268d224d",
					"name": "양형석",
					"type": "작업자",
					"parent": "37"
				},
				{
					"id": "626551d434b9b70068796c1e",
					"name": "moon",
					"type": "작업자",
					"parent": "37,35,74"
				},
				{
					"id": "712020:4fc33a35-859f-4ac8-8956-b22581115623",
					"name": "gkfn185",
					"type": "작업자",
					"parent": "37,36,55"
				},
				{
					"id": "619ae743b43d5b006adef72c",
					"name": "김찬호",
					"type": "작업자",
					"parent": "37,36,55"
				},
				{
					"id": "hsyang",
					"name": "hsyang",
					"type": "작업자",
					"parent": "37,33,55,59"
				},
				{
					"id": "5ffe4999f7ea2a0107f8c6f6",
					"name": "최수현",
					"type": "작업자",
					"parent": "37,36,55"
				},
				{
					"id": "dumbbelloper",
					"name": "dumbbelloper",
					"type": "작업자",
					"parent": "33,35"
				},
				{
					"id": "gkfn185",
					"name": "gkfn185",
					"type": "작업자",
					"parent": "33"
				},
				{
					"id": "1",
					"name": "Redmine Admin",
					"type": "작업자",
					"parent": "55"
				},
				{
					"id": "admin",
					"name": "admin",
					"type": "작업자",
					"parent": "55"
				},
				{
					"id": "63b2a039159df2c252e826e9",
					"name": "이동민",
					"type": "작업자",
					"parent": "61"
				},
				{
					"id": "admin",
					"name": "admin",
					"type": "작업자",
					"parent": "55"
				},
				{
					"id": "63b2a039159df2c252e826e9",
					"name": "이동민",
					"type": "작업자",
					"parent": "61"
				},
				{
					"id": "admin",
					"name": "admin",
					"type": "작업자",
					"parent": "37"
				},
				{
					"id": "63b2a039159df2c252e826ee",
					"name": "이동민",
					"type": "작업자",
					"parent": "61"
				},
				{
					"id": "admin",
					"name": "admin",
					"type": "작업자",
					"parent": "74"
				},
				{
					"id": "63b2a039159df2c252e826e9",
					"name": "이동민",
					"type": "작업자",
					"parent": "37"
				},
				{
					"id": "admin",
					"name": "admin",
					"type": "작업자",
					"parent": "36"
				},
				{
					"id": "63b2a039159df2c252e826e9",
					"name": "이동민",
					"type": "작업자",
					"parent": "55"
				},
				{
					"id": "No-Worker",
					"name": "No-Worker",
					"type": "No-Worker",
					"parent": ""
				}
			];
			var modifyData = function(mock_data) {
				let products = {};
				let versions = {};
				let workers = [];
				let result = [];

				mock_data.forEach(item => {
					if (item.type === "제품") {
						let itemId = item.id.split("-")[0];
						products[itemId] = { id: itemId, name: item.name };
						//products[item.id] = { id: item.id, name: item.name };
					} else if (item.type === "버전") {
						let itemId = item.id.split("-")[0];
						versions[itemId] = { id: itemId, name: item.name, product: products["22"] };
					} else if(item.type ==="작업자") {
						item.parent.split(',').forEach(parentId => {
							if (versions[parentId]) {
								workers.push({
									product: versions[parentId].product,
									version: versions[parentId],
									worker: { id: item.id, name: item.name }
								});
							}
						});
					}
				});

				workers.forEach(worker => {
					result.push({
						"제품(서비스) 키": worker.product.id,
						"제품(서비스) 명": worker.product.name,
						"버전 키": worker.version.id,
						"버전 명": worker.version.name,
						"작업자 키": worker.worker.id,
						"작업자 명": worker.worker.name
					});
				});

				return result;
			};
			let excelData = modifyData(mock_data);
			console.log(excelData);

			// 커스텀 옵션 정의
			let customOptions = { search:false };

			ModalTabFunction.setColumns(columnList);
			ModalTabFunction.setExcelData(excelData);
			ModalTabFunction.setOptions(customOptions);
			ModalTabFunction.drawExcel("modal_excel");

		});
	}
</script>